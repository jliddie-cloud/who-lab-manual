<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Coding practices | WHO Lab Manual</title>
  <meta name="description" content="Lab practices and data science best practices" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Coding practices | WHO Lab Manual" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Lab practices and data science best practices" />
  <meta name="github-repo" content="water-health-opportunity-lab/who-lab-manual" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Coding practices | WHO Lab Manual" />
  
  <meta name="twitter:description" content="Lab practices and data science best practices" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="code-repositories.html"/>
<link rel="next" href="coding-style.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">WHO Lab Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome to the WHO Lab!</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#about-the-lab"><i class="fa fa-check"></i><b>1.1</b> About the lab</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#about-this-lab-manual"><i class="fa fa-check"></i><b>1.2</b> About this lab manual</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="culture-and-conduct.html"><a href="culture-and-conduct.html"><i class="fa fa-check"></i><b>2</b> Culture and conduct</a>
<ul>
<li class="chapter" data-level="2.1" data-path="culture-and-conduct.html"><a href="culture-and-conduct.html#lab-culture"><i class="fa fa-check"></i><b>2.1</b> Lab culture</a></li>
<li class="chapter" data-level="2.2" data-path="culture-and-conduct.html"><a href="culture-and-conduct.html#diversity-equity-and-inclusion"><i class="fa fa-check"></i><b>2.2</b> Diversity, equity, and inclusion</a></li>
<li class="chapter" data-level="2.3" data-path="culture-and-conduct.html"><a href="culture-and-conduct.html#protecting-human-subjects"><i class="fa fa-check"></i><b>2.3</b> Protecting human subjects</a></li>
<li class="chapter" data-level="2.4" data-path="culture-and-conduct.html"><a href="culture-and-conduct.html#authorship"><i class="fa fa-check"></i><b>2.4</b> Authorship</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="communication-and-coordination.html"><a href="communication-and-coordination.html"><i class="fa fa-check"></i><b>3</b> Communication and coordination</a>
<ul>
<li class="chapter" data-level="3.1" data-path="communication-and-coordination.html"><a href="communication-and-coordination.html#slack"><i class="fa fa-check"></i><b>3.1</b> Slack</a></li>
<li class="chapter" data-level="3.2" data-path="communication-and-coordination.html"><a href="communication-and-coordination.html#email"><i class="fa fa-check"></i><b>3.2</b> Email</a></li>
<li class="chapter" data-level="3.3" data-path="communication-and-coordination.html"><a href="communication-and-coordination.html#trello"><i class="fa fa-check"></i><b>3.3</b> Trello</a></li>
<li class="chapter" data-level="3.4" data-path="communication-and-coordination.html"><a href="communication-and-coordination.html#google-drives"><i class="fa fa-check"></i><b>3.4</b> Google Drives</a></li>
<li class="chapter" data-level="3.5" data-path="communication-and-coordination.html"><a href="communication-and-coordination.html#meetings"><i class="fa fa-check"></i><b>3.5</b> Meetings</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reproducibility.html"><a href="reproducibility.html"><i class="fa fa-check"></i><b>4</b> Reproducibility</a>
<ul>
<li class="chapter" data-level="4.1" data-path="reproducibility.html"><a href="reproducibility.html#what-is-the-reproducibility-crisis"><i class="fa fa-check"></i><b>4.1</b> What is the reproducibility crisis?</a></li>
<li class="chapter" data-level="4.2" data-path="reproducibility.html"><a href="reproducibility.html#study-design"><i class="fa fa-check"></i><b>4.2</b> Study design</a></li>
<li class="chapter" data-level="4.3" data-path="reproducibility.html"><a href="reproducibility.html#register-study-protocols"><i class="fa fa-check"></i><b>4.3</b> Register study protocols</a></li>
<li class="chapter" data-level="4.4" data-path="reproducibility.html"><a href="reproducibility.html#write-and-register-pre-analysis-plans"><i class="fa fa-check"></i><b>4.4</b> Write and register pre-analysis plans</a></li>
<li class="chapter" data-level="4.5" data-path="reproducibility.html"><a href="reproducibility.html#create-reproducible-workflows"><i class="fa fa-check"></i><b>4.5</b> Create reproducible workflows</a></li>
<li class="chapter" data-level="4.6" data-path="reproducibility.html"><a href="reproducibility.html#process-and-analyze-data-with-internal-replication-and-masking"><i class="fa fa-check"></i><b>4.6</b> Process and analyze data with internal replication and masking</a></li>
<li class="chapter" data-level="4.7" data-path="reproducibility.html"><a href="reproducibility.html#use-reporting-checklists-with-manuscripts"><i class="fa fa-check"></i><b>4.7</b> Use reporting checklists with manuscripts</a></li>
<li class="chapter" data-level="4.8" data-path="reproducibility.html"><a href="reproducibility.html#publish-preprints"><i class="fa fa-check"></i><b>4.8</b> Publish preprints</a></li>
<li class="chapter" data-level="4.9" data-path="reproducibility.html"><a href="reproducibility.html#publish-data-when-possible-and-replication-scripts"><i class="fa fa-check"></i><b>4.9</b> Publish data (when possible) and replication scripts</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="code-repositories.html"><a href="code-repositories.html"><i class="fa fa-check"></i><b>5</b> Code repositories</a>
<ul>
<li class="chapter" data-level="5.1" data-path="code-repositories.html"><a href="code-repositories.html#project-structure"><i class="fa fa-check"></i><b>5.1</b> Project Structure</a></li>
<li class="chapter" data-level="5.2" data-path="code-repositories.html"><a href="code-repositories.html#rproj-files"><i class="fa fa-check"></i><b>5.2</b> <code>.Rproj</code> files</a></li>
<li class="chapter" data-level="5.3" data-path="code-repositories.html"><a href="code-repositories.html#configuration-config-file"><i class="fa fa-check"></i><b>5.3</b> Configuration (‘config’) File</a></li>
<li class="chapter" data-level="5.4" data-path="code-repositories.html"><a href="code-repositories.html#order-files-and-directories"><i class="fa fa-check"></i><b>5.4</b> Order Files and Directories</a></li>
<li class="chapter" data-level="5.5" data-path="code-repositories.html"><a href="code-repositories.html#using-bash-scripts-to-ensure-reproducibility"><i class="fa fa-check"></i><b>5.5</b> Using Bash scripts to ensure reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="coding-practices.html"><a href="coding-practices.html"><i class="fa fa-check"></i><b>6</b> Coding practices</a>
<ul>
<li class="chapter" data-level="6.1" data-path="coding-practices.html"><a href="coding-practices.html#organizing-scripts"><i class="fa fa-check"></i><b>6.1</b> Organizing scripts</a></li>
<li class="chapter" data-level="6.2" data-path="coding-practices.html"><a href="coding-practices.html#documenting-your-code"><i class="fa fa-check"></i><b>6.2</b> Documenting your code</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="coding-practices.html"><a href="coding-practices.html#file-headers"><i class="fa fa-check"></i><b>6.2.1</b> File headers</a></li>
<li class="chapter" data-level="6.2.2" data-path="coding-practices.html"><a href="coding-practices.html#sections-and-subsections"><i class="fa fa-check"></i><b>6.2.2</b> Sections and subsections</a></li>
<li class="chapter" data-level="6.2.3" data-path="coding-practices.html"><a href="coding-practices.html#code-folding"><i class="fa fa-check"></i><b>6.2.3</b> Code folding</a></li>
<li class="chapter" data-level="6.2.4" data-path="coding-practices.html"><a href="coding-practices.html#comments-in-the-body-of-your-script"><i class="fa fa-check"></i><b>6.2.4</b> Comments in the body of your script</a></li>
<li class="chapter" data-level="6.2.5" data-path="coding-practices.html"><a href="coding-practices.html#function-documentation"><i class="fa fa-check"></i><b>6.2.5</b> Function documentation</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="coding-practices.html"><a href="coding-practices.html#object-naming"><i class="fa fa-check"></i><b>6.3</b> Object naming</a></li>
<li class="chapter" data-level="6.4" data-path="coding-practices.html"><a href="coding-practices.html#function-calls"><i class="fa fa-check"></i><b>6.4</b> Function calls</a></li>
<li class="chapter" data-level="6.5" data-path="coding-practices.html"><a href="coding-practices.html#the-here-package"><i class="fa fa-check"></i><b>6.5</b> The here package</a></li>
<li class="chapter" data-level="6.6" data-path="coding-practices.html"><a href="coding-practices.html#readingsaving-data"><i class="fa fa-check"></i><b>6.6</b> Reading/Saving Data</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="coding-practices.html"><a href="coding-practices.html#rds-vs-.rdata-files"><i class="fa fa-check"></i><b>6.6.1</b> <code>.RDS</code> vs <code>.RData</code> Files</a></li>
<li class="chapter" data-level="6.6.2" data-path="coding-practices.html"><a href="coding-practices.html#csvs"><i class="fa fa-check"></i><b>6.6.2</b> CSVs</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="coding-practices.html"><a href="coding-practices.html#integrating-box-and-dropbox"><i class="fa fa-check"></i><b>6.7</b> Integrating Box and Dropbox</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="coding-practices.html"><a href="coding-practices.html#box"><i class="fa fa-check"></i><b>6.7.1</b> Box</a></li>
<li class="chapter" data-level="6.7.2" data-path="coding-practices.html"><a href="coding-practices.html#dropbox"><i class="fa fa-check"></i><b>6.7.2</b> Dropbox</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="coding-practices.html"><a href="coding-practices.html#tidyverse"><i class="fa fa-check"></i><b>6.8</b> Tidyverse</a></li>
<li class="chapter" data-level="6.9" data-path="coding-practices.html"><a href="coding-practices.html#coding-with-r-and-python"><i class="fa fa-check"></i><b>6.9</b> Coding with R and Python</a></li>
<li class="chapter" data-level="6.10" data-path="coding-practices.html"><a href="coding-practices.html#repeating-analyses-with-different-variations"><i class="fa fa-check"></i><b>6.10</b> Repeating analyses with different variations</a>
<ul>
<li class="chapter" data-level="6.10.1" data-path="coding-practices.html"><a href="coding-practices.html#lapply-and-sapply"><i class="fa fa-check"></i><b>6.10.1</b> <code>lapply()</code> and <code>sapply()</code></a></li>
<li class="chapter" data-level="6.10.2" data-path="coding-practices.html"><a href="coding-practices.html#mapply-and-pmap"><i class="fa fa-check"></i><b>6.10.2</b> <code>mapply()</code> and <code>pmap()</code></a></li>
<li class="chapter" data-level="6.10.3" data-path="coding-practices.html"><a href="coding-practices.html#parallel-processing-with-parallel-and-future-packages"><i class="fa fa-check"></i><b>6.10.3</b> Parallel processing with <code>parallel</code> and <code>future</code> packages</a></li>
</ul></li>
<li class="chapter" data-level="6.11" data-path="coding-practices.html"><a href="coding-practices.html#reviewing-code"><i class="fa fa-check"></i><b>6.11</b> Reviewing Code</a>
<ul>
<li class="chapter" data-level="6.11.1" data-path="coding-practices.html"><a href="coding-practices.html#creating-a-pull-request-template"><i class="fa fa-check"></i><b>6.11.1</b> Creating a Pull Request Template</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="coding-style.html"><a href="coding-style.html"><i class="fa fa-check"></i><b>7</b> Coding style</a>
<ul>
<li class="chapter" data-level="7.1" data-path="coding-style.html"><a href="coding-style.html#comments"><i class="fa fa-check"></i><b>7.1</b> Comments</a></li>
<li class="chapter" data-level="7.2" data-path="coding-style.html"><a href="coding-style.html#line-breaks"><i class="fa fa-check"></i><b>7.2</b> Line breaks</a></li>
<li class="chapter" data-level="7.3" data-path="coding-style.html"><a href="coding-style.html#automated-tools-for-style-and-project-workflow"><i class="fa fa-check"></i><b>7.3</b> Automated Tools for Style and Project Workflow</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="coding-style.html"><a href="coding-style.html#styling"><i class="fa fa-check"></i><b>7.3.1</b> Styling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="working-with-big-data.html"><a href="working-with-big-data.html"><i class="fa fa-check"></i><b>8</b> Working with Big Data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="working-with-big-data.html"><a href="working-with-big-data.html#the-data.table-package"><i class="fa fa-check"></i><b>8.1</b> The data.table package</a></li>
<li class="chapter" data-level="8.2" data-path="working-with-big-data.html"><a href="working-with-big-data.html#using-downsampled-data"><i class="fa fa-check"></i><b>8.2</b> Using downsampled data</a></li>
<li class="chapter" data-level="8.3" data-path="working-with-big-data.html"><a href="working-with-big-data.html#optimal-rstudio-set-up"><i class="fa fa-check"></i><b>8.3</b> Optimal RStudio set up</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="data-masking.html"><a href="data-masking.html"><i class="fa fa-check"></i><b>9</b> Data masking</a>
<ul>
<li class="chapter" data-level="9.1" data-path="data-masking.html"><a href="data-masking.html#general-overview"><i class="fa fa-check"></i><b>9.1</b> General Overview</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="data-masking.html"><a href="data-masking.html#what-is-data-masking"><i class="fa fa-check"></i><b>9.1.1</b> What is Data Masking?</a></li>
<li class="chapter" data-level="9.1.2" data-path="data-masking.html"><a href="data-masking.html#using-tidy-evaluation-for-data-masking"><i class="fa fa-check"></i><b>9.1.2</b> Using tidy evaluation for data masking</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="data-masking.html"><a href="data-masking.html#technical-overview"><i class="fa fa-check"></i><b>9.2</b> Technical Overview</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="data-masking.html"><a href="data-masking.html#example"><i class="fa fa-check"></i><b>9.2.1</b> Example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="github.html"><a href="github.html"><i class="fa fa-check"></i><b>10</b> Github</a>
<ul>
<li class="chapter" data-level="10.1" data-path="github.html"><a href="github.html#basics"><i class="fa fa-check"></i><b>10.1</b> Basics</a></li>
<li class="chapter" data-level="10.2" data-path="github.html"><a href="github.html#github-desktop"><i class="fa fa-check"></i><b>10.2</b> Github Desktop</a></li>
<li class="chapter" data-level="10.3" data-path="github.html"><a href="github.html#git-branching"><i class="fa fa-check"></i><b>10.3</b> Git Branching</a></li>
<li class="chapter" data-level="10.4" data-path="github.html"><a href="github.html#example-workflow"><i class="fa fa-check"></i><b>10.4</b> Example Workflow</a></li>
<li class="chapter" data-level="10.5" data-path="github.html"><a href="github.html#commonly-used-git-commands"><i class="fa fa-check"></i><b>10.5</b> Commonly Used Git Commands</a></li>
<li class="chapter" data-level="10.6" data-path="github.html"><a href="github.html#how-often-should-i-commit"><i class="fa fa-check"></i><b>10.6</b> How often should I commit?</a></li>
<li class="chapter" data-level="10.7" data-path="github.html"><a href="github.html#what-should-be-pushed-to-github"><i class="fa fa-check"></i><b>10.7</b> What should be pushed to Github?</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="unix.html"><a href="unix.html"><i class="fa fa-check"></i><b>11</b> Unix commands</a>
<ul>
<li class="chapter" data-level="11.1" data-path="unix.html"><a href="unix.html#basics-1"><i class="fa fa-check"></i><b>11.1</b> Basics</a></li>
<li class="chapter" data-level="11.2" data-path="unix.html"><a href="unix.html#syntax-for-both-macwindows"><i class="fa fa-check"></i><b>11.2</b> Syntax for both Mac/Windows</a></li>
<li class="chapter" data-level="11.3" data-path="unix.html"><a href="unix.html#running-bash-scripts"><i class="fa fa-check"></i><b>11.3</b> Running Bash Scripts</a></li>
<li class="chapter" data-level="11.4" data-path="unix.html"><a href="unix.html#running-rscripts-in-windows"><i class="fa fa-check"></i><b>11.4</b> Running Rscripts in Windows</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="unix.html"><a href="unix.html#common-mistakes"><i class="fa fa-check"></i><b>11.4.1</b> Common Mistakes</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="unix.html"><a href="unix.html#checking-tasks-and-killing-jobs"><i class="fa fa-check"></i><b>11.5</b> Checking tasks and killing jobs</a></li>
<li class="chapter" data-level="11.6" data-path="unix.html"><a href="unix.html#running-big-jobs"><i class="fa fa-check"></i><b>11.6</b> Running big jobs</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="unix.html"><a href="unix.html#example-code-for-runfilesavelogs"><i class="fa fa-check"></i><b>11.6.1</b> Example code for <code>runfileSaveLogs</code></a></li>
<li class="chapter" data-level="11.6.2" data-path="unix.html"><a href="unix.html#example-usage-for-runfilesavelogs"><i class="fa fa-check"></i><b>11.6.2</b> Example usage for <code>runfileSaveLogs</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="reproducible-environments.html"><a href="reproducible-environments.html"><i class="fa fa-check"></i><b>12</b> Reproducible Environments</a>
<ul>
<li class="chapter" data-level="12.1" data-path="reproducible-environments.html"><a href="reproducible-environments.html#package-version-control-with-renv"><i class="fa fa-check"></i><b>12.1</b> Package Version Control with renv</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="reproducible-environments.html"><a href="reproducible-environments.html#introduction"><i class="fa fa-check"></i><b>12.1.1</b> Introduction</a></li>
<li class="chapter" data-level="12.1.2" data-path="reproducible-environments.html"><a href="reproducible-environments.html#implementing-renv-in-projects"><i class="fa fa-check"></i><b>12.1.2</b> Implementing renv in projects</a></li>
<li class="chapter" data-level="12.1.3" data-path="reproducible-environments.html"><a href="reproducible-environments.html#using-projects-with-renv"><i class="fa fa-check"></i><b>12.1.3</b> Using projects with renv</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="code-publication.html"><a href="code-publication.html"><i class="fa fa-check"></i><b>13</b> Code Publication</a>
<ul>
<li class="chapter" data-level="13.1" data-path="code-publication.html"><a href="code-publication.html#checklist-overview"><i class="fa fa-check"></i><b>13.1</b> Checklist overview</a></li>
<li class="chapter" data-level="13.2" data-path="code-publication.html"><a href="code-publication.html#fill-out-file-headers"><i class="fa fa-check"></i><b>13.2</b> Fill out file headers</a></li>
<li class="chapter" data-level="13.3" data-path="code-publication.html"><a href="code-publication.html#clean-up-comments"><i class="fa fa-check"></i><b>13.3</b> Clean up comments</a></li>
<li class="chapter" data-level="13.4" data-path="code-publication.html"><a href="code-publication.html#document-functions"><i class="fa fa-check"></i><b>13.4</b> Document functions</a></li>
<li class="chapter" data-level="13.5" data-path="code-publication.html"><a href="code-publication.html#remove-deprecated-filepaths"><i class="fa fa-check"></i><b>13.5</b> Remove deprecated filepaths</a></li>
<li class="chapter" data-level="13.6" data-path="code-publication.html"><a href="code-publication.html#ensure-project-runs-via-bash"><i class="fa fa-check"></i><b>13.6</b> Ensure project runs via bash</a></li>
<li class="chapter" data-level="13.7" data-path="code-publication.html"><a href="code-publication.html#complete-the-readme"><i class="fa fa-check"></i><b>13.7</b> Complete the README</a></li>
<li class="chapter" data-level="13.8" data-path="code-publication.html"><a href="code-publication.html#clean-up-feature-branches"><i class="fa fa-check"></i><b>13.8</b> Clean up feature branches</a></li>
<li class="chapter" data-level="13.9" data-path="code-publication.html"><a href="code-publication.html#create-github-release"><i class="fa fa-check"></i><b>13.9</b> Create Github release</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="data-publication.html"><a href="data-publication.html"><i class="fa fa-check"></i><b>14</b> Data Publication</a>
<ul>
<li class="chapter" data-level="14.1" data-path="data-publication.html"><a href="data-publication.html#overview"><i class="fa fa-check"></i><b>14.1</b> Overview</a></li>
<li class="chapter" data-level="14.2" data-path="data-publication.html"><a href="data-publication.html#removing-phi"><i class="fa fa-check"></i><b>14.2</b> Removing PHI</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="data-publication.html"><a href="data-publication.html#personal-information"><i class="fa fa-check"></i><b>14.2.1</b> Personal information</a></li>
<li class="chapter" data-level="14.2.2" data-path="data-publication.html"><a href="data-publication.html#dates"><i class="fa fa-check"></i><b>14.2.2</b> Dates</a></li>
<li class="chapter" data-level="14.2.3" data-path="data-publication.html"><a href="data-publication.html#geographic-information"><i class="fa fa-check"></i><b>14.2.3</b> Geographic information</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="data-publication.html"><a href="data-publication.html#create-public-ids"><i class="fa fa-check"></i><b>14.3</b> Create public IDs</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="data-publication.html"><a href="data-publication.html#rationale"><i class="fa fa-check"></i><b>14.3.1</b> Rationale</a></li>
<li class="chapter" data-level="14.3.2" data-path="data-publication.html"><a href="data-publication.html#a-single-set-of-public-ids-for-each-study"><i class="fa fa-check"></i><b>14.3.2</b> A single set of public IDs for each study</a></li>
<li class="chapter" data-level="14.3.3" data-path="data-publication.html"><a href="data-publication.html#example-scripts"><i class="fa fa-check"></i><b>14.3.3</b> Example scripts</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="data-publication.html"><a href="data-publication.html#create-a-data-repository"><i class="fa fa-check"></i><b>14.4</b> Create a data repository</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="data-publication.html"><a href="data-publication.html#steps-for-creating-an-open-science-framework-osf-repository"><i class="fa fa-check"></i><b>14.4.1</b> Steps for creating an Open Science Framework (OSF) repository:</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="data-publication.html"><a href="data-publication.html#edit-and-test-analysis-scripts"><i class="fa fa-check"></i><b>14.5</b> Edit and test analysis scripts</a></li>
<li class="chapter" data-level="14.6" data-path="data-publication.html"><a href="data-publication.html#create-a-public-github-page-for-public-scripts"><i class="fa fa-check"></i><b>14.6</b> Create a public GitHub page for public scripts</a></li>
<li class="chapter" data-level="14.7" data-path="data-publication.html"><a href="data-publication.html#go-live"><i class="fa fa-check"></i><b>14.7</b> Go live</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="slurm.html"><a href="slurm.html"><i class="fa fa-check"></i><b>15</b> Slurm and cluster computing</a>
<ul>
<li class="chapter" data-level="15.1" data-path="slurm.html"><a href="slurm.html#getting-started"><i class="fa fa-check"></i><b>15.1</b> Getting started</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="slurm.html"><a href="slurm.html#one-time-system-set-up"><i class="fa fa-check"></i><b>15.1.1</b> One-Time System Set-Up</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="slurm.html"><a href="slurm.html#moving-files-to-sherlock"><i class="fa fa-check"></i><b>15.2</b> Moving files to Sherlock</a></li>
<li class="chapter" data-level="15.3" data-path="slurm.html"><a href="slurm.html#installing-packages-on-sherlock"><i class="fa fa-check"></i><b>15.3</b> Installing packages on Sherlock</a></li>
<li class="chapter" data-level="15.4" data-path="slurm.html"><a href="slurm.html#testing-your-code"><i class="fa fa-check"></i><b>15.4</b> Testing your code</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="slurm.html"><a href="slurm.html#the-command-line"><i class="fa fa-check"></i><b>15.4.1</b> The command line</a></li>
<li class="chapter" data-level="15.4.2" data-path="slurm.html"><a href="slurm.html#the-sherlock-ondemand-dashboard"><i class="fa fa-check"></i><b>15.4.2</b> The Sherlock OnDemand Dashboard</a></li>
<li class="chapter" data-level="15.4.3" data-path="slurm.html"><a href="slurm.html#filepaths-configuration-on-sherlock"><i class="fa fa-check"></i><b>15.4.3</b> Filepaths &amp; configuration on Sherlock</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="slurm.html"><a href="slurm.html#storage-group-storage-access"><i class="fa fa-check"></i><b>15.5</b> Storage &amp; group storage access</a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="slurm.html"><a href="slurm.html#individual-storage"><i class="fa fa-check"></i><b>15.5.1</b> Individual storage</a></li>
<li class="chapter" data-level="15.5.2" data-path="slurm.html"><a href="slurm.html#group-storage"><i class="fa fa-check"></i><b>15.5.2</b> Group storage</a></li>
<li class="chapter" data-level="15.5.3" data-path="slurm.html"><a href="slurm.html#folder-permissions"><i class="fa fa-check"></i><b>15.5.3</b> Folder permissions</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="slurm.html"><a href="slurm.html#running-big-jobs-1"><i class="fa fa-check"></i><b>15.6</b> Running big jobs</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="checklists.html"><a href="checklists.html"><i class="fa fa-check"></i><b>16</b> Checklists</a>
<ul>
<li class="chapter" data-level="16.1" data-path="checklists.html"><a href="checklists.html#pre-analysis-plan-checklist"><i class="fa fa-check"></i><b>16.1</b> Pre-analysis plan checklist</a></li>
<li class="chapter" data-level="16.2" data-path="checklists.html"><a href="checklists.html#code-checklist"><i class="fa fa-check"></i><b>16.2</b> Code checklist</a></li>
<li class="chapter" data-level="16.3" data-path="checklists.html"><a href="checklists.html#manuscript-checklist"><i class="fa fa-check"></i><b>16.3</b> Manuscript checklist</a></li>
<li class="chapter" data-level="16.4" data-path="checklists.html"><a href="checklists.html#figure-checklist"><i class="fa fa-check"></i><b>16.4</b> Figure checklist</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>17</b> Resources</a>
<ul>
<li class="chapter" data-level="17.1" data-path="resources.html"><a href="resources.html#resources-for-r"><i class="fa fa-check"></i><b>17.1</b> Resources for R</a></li>
<li class="chapter" data-level="17.2" data-path="resources.html"><a href="resources.html#resources-for-git-github"><i class="fa fa-check"></i><b>17.2</b> Resources for Git &amp; Github</a></li>
<li class="chapter" data-level="17.3" data-path="resources.html"><a href="resources.html#scientific-figures"><i class="fa fa-check"></i><b>17.3</b> Scientific figures</a></li>
<li class="chapter" data-level="17.4" data-path="resources.html"><a href="resources.html#writing"><i class="fa fa-check"></i><b>17.4</b> Writing</a></li>
<li class="chapter" data-level="17.5" data-path="resources.html"><a href="resources.html#presentations"><i class="fa fa-check"></i><b>17.5</b> Presentations</a></li>
<li class="chapter" data-level="17.6" data-path="resources.html"><a href="resources.html#professional-advice"><i class="fa fa-check"></i><b>17.6</b> Professional advice</a></li>
<li class="chapter" data-level="17.7" data-path="resources.html"><a href="resources.html#funding"><i class="fa fa-check"></i><b>17.7</b> Funding</a></li>
<li class="chapter" data-level="17.8" data-path="resources.html"><a href="resources.html#ethics-and-global-health-research"><i class="fa fa-check"></i><b>17.8</b> Ethics and global health research</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/water-health-opportunity-lab/who-lab-manual" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">WHO Lab Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="coding-practices" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Coding practices<a href="coding-practices.html#coding-practices" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>by Kunal Mishra, Jade Benjamin-Chung, Stephanie Djajadi, and Iris Tong</p>
<div id="organizing-scripts" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Organizing scripts<a href="coding-practices.html#organizing-scripts" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Just as your data “flows” through your project, data should flow naturally through a script. Very generally, you want to:</p>
<ol style="list-style-type: decimal">
<li>describe the work completed in the script in a comment header</li>
<li>source your configuration file (<code>0-config.R</code>)</li>
<li>load all your data</li>
<li>do all your analysis/computation</li>
<li>save your data.</li>
</ol>
<p>Each of these sections should be “chunked together” using comments. See <a href="https://github.com/kmishra9/Flu-Absenteeism/blob/master/Master&#39;s%20Thesis%20-%20Spatial%20Epidemiology%20of%20Influenza/2a%20-%20Statistical-Inputs.R">this file</a> for a good example of how to cleanly organize a file in a way that follows this “flow” and functionally separate pieces of code that are doing different things.</p>
</div>
<div id="documenting-your-code" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Documenting your code<a href="coding-practices.html#documenting-your-code" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="file-headers" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> File headers<a href="coding-practices.html#file-headers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Every file in a project should have a header that allows it to be interpreted on its own. It should include the name of the project and a short description for what this file (among the many in your project) does specifically. You may optionally wish to include the inputs and outputs of the script as well, though the next section makes this significantly less necessary.</p>
<pre><code>################################################################################
# @Organization - Example Organization
# @Project - Example Project
# @Description - This file is responsible for [...]
################################################################################
</code></pre>
</div>
<div id="sections-and-subsections" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Sections and subsections<a href="coding-practices.html#sections-and-subsections" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Rstudio (<a href="https://blog.rstudio.com/2020/12/02/rstudio-v1-4-preview-little-things/">v1.4 or more recent</a>) supports the use of Sections and Subsections. You can easily navigate through longer scripts using the navigation pane in RStudio, as shown on the right below.</p>
<pre><code># Section -------

## Subsection -------

### Sub-subsection -------</code></pre>
</div>
<div id="code-folding" class="section level3 hasAnchor" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Code folding<a href="coding-practices.html#code-folding" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Consider using RStudio’s <a href="https://support.rstudio.com/hc/en-us/articles/200484568-Code-Folding-and-Sections">code folding</a> feature to collapse and expand different sections of your code. Any comment line with at least four trailing dashes (-), equal signs (=), or pound signs (#) automatically creates a code section. For example:</p>
</div>
<div id="comments-in-the-body-of-your-script" class="section level3 hasAnchor" number="6.2.4">
<h3><span class="header-section-number">6.2.4</span> Comments in the body of your script<a href="coding-practices.html#comments-in-the-body-of-your-script" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Commenting your code is an important part of reproducibility and helps document your code for the future. When things change or break, you’ll be thankful for comments. There’s no need to comment excessively or unnecessarily, but a comment describing what a large or complex chunk of code does is always helpful. See <a href="https://github.com/kmishra9/Flu-Absenteeism/blob/master/Master&#39;s%20Thesis%20-%20Spatial%20Epidemiology%20of%20Influenza/1b%20-%20Map-Management.R">this file</a> for an example of how to comment your code and notice that comments are always in the form of:</p>
<p><code># This is a comment -- first letter is capitalized and spaced away from the pound sign</code></p>
</div>
<div id="function-documentation" class="section level3 hasAnchor" number="6.2.5">
<h3><span class="header-section-number">6.2.5</span> Function documentation<a href="coding-practices.html#function-documentation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Every function you write must include a header to document its purpose, inputs, and outputs. For any reproducible workflows, they are essential, because R is dynamically typed. This means, you can pass a <code>string</code> into an argument that is meant to be a <code>data.table</code>, or a <code>list</code> into an argument meant for a <code>tibble</code>. It is the responsibility of a function’s author to document what each argument is meant to do and its basic type. This is an example for documenting a function (inspired by <a href="https://www.oracle.com/technetwork/java/javase/documentation/index-137868.html#format">JavaDocs</a> and R’s <a href="https://blog.rstudio.com/2018/10/23/rstudio-1-2-preview-plumber-integration/">Plumber API docs</a>):</p>
<pre><code>##############################################
##############################################
# Documentation: calc_fluseas_mean
# Usage: calc_fluseas_mean(data, yname)
# Description: Make a dataframe with rows for flu season and site
# and the number of patients with an outcome, the total patients,
# and the percent of patients with the outcome

# Args/Options:
# data: a data frame with variables flu_season, site, studyID, and yname
# yname: a string for the outcome name
# silent: a boolean specifying whether the function shouldn&#39;t output anything to the console (DEFAULT: TRUE)

# Returns: the dataframe as described above
# Output: prints the data frame described above if silent is not True

calc_fluseas_mean = function(data, yname, silent = TRUE) {
 ### function code here 

}</code></pre>
<p>The header tells you what the function does, its various inputs, and how you might go about using the function to do what you want. Also notice that all optional arguments (i.e. ones with pre-specified defaults) follow arguments that require user input.</p>
<ul>
<li><p><strong>Note</strong>: As someone trying to call a function, it is possible to access a function’s documentation (and internal code) by <code>CMD-Left-Click</code>ing the function’s name in RStudio</p></li>
<li><p><strong>Note</strong>: Depending on how important your function is, the complexity of your function code, and the complexity of different types of data in your project, you can also add “type-checking” to your function with the <code>assertthat::assert_that()</code> function. You can, for example, <code>assert_that(is.data.frame(statistical_input))</code>, which will ensure that collaborators or reviewers of your project attempting to use your function are using it in the way that it is intended by calling it with (at the minimum) the correct type of arguments. You can extend this to ensure that certain assumptions regarding the inputs are fulfilled as well (i.e. that <code>time_column</code>, <code>location_column</code>, <code>value_column</code>, and <code>population_column</code> all exist within the <code>statistical_input</code> tibble).</p></li>
</ul>
</div>
</div>
<div id="object-naming" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Object naming<a href="coding-practices.html#object-naming" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Generally we recommend using nouns for objects and verbs for functions. This is because functions are performing actions, while objects are not.</p>
<p>Try to make your variable names both more expressive and more explicit. Being a bit more verbose is useful and easy in the age of autocompletion! For example, instead of naming a variable <code>vaxcov_1718</code>, try naming it <code>vaccination_coverage_2017_18</code>. Similarly, <code>flu_res</code> could be named <code>absentee_flu_residuals</code>, making your code more readable and explicit.</p>
<ul>
<li>For more help, check out <a href="https://spin.atomicobject.com/2017/11/01/good-variable-names/">Be Expressive: How to Give Your Variables Better Names</a></li>
</ul>
<p>We recommend you use <strong>Snake_Case</strong>.</p>
<ul>
<li><p>Base R allows <code>.</code> in variable names and functions (such as <code>read.csv()</code>), but this goes against best practices for variable naming in many other coding languages. For consistency’s sake, <code>snake_case</code> has been adopted across languages, and modern packages and functions typically use it (i.e. <code>readr::read_csv()</code>). As a very general rule of thumb, if a package you’re using doesn’t use <code>snake_case</code>, there may be an updated version or more modern package that <em>does</em>, bringing with it the variety of performance improvements and bug fixes inherent in more mature and modern software.</p></li>
<li><p><strong>Note</strong>: you may also see <code>camelCase</code> throughout the R code you come across. This is <em>okay</em> but not ideal – try to stay consistent across all your code with <code>snake_case</code>.</p></li>
<li><p><strong>Note</strong>: again, its also worth noting there’s nothing inherently wrong with using <code>.</code> in variable names, just that it goes against style best practices that are cropping up in data science, so its worth getting rid of these bad habits now.</p></li>
</ul>
</div>
<div id="function-calls" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Function calls<a href="coding-practices.html#function-calls" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In a function call, use “named arguments” and put each argument on a separate line to make your code more readable.</p>
<p>Here’s an example of what not to do when calling the function a function <code>calc_fluseas_mean</code> (defined above):</p>
<pre><code>mean_Y = calc_fluseas_mean(flu_data, &quot;maari_yn&quot;, FALSE)</code></pre>
<p>And here it is again using the best practices we’ve outlined:</p>
<pre><code>mean_Y = calc_fluseas_mean(
  data = flu_data, 
  yname = &quot;maari_yn&quot;,
  silent = FALSE
)</code></pre>
</div>
<div id="the-here-package" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> The here package<a href="coding-practices.html#the-here-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>here</code> package is one great R package that helps multiple collaborators deal with the mess that is working directories within an R project structure. Let’s say we have an R project at the path <code>/home/oski/Some-R-Project</code>. My collaborator might clone the repository and work with it at some other path, such as <code>/home/bear/R-Code/Some-R-Project</code>. Dealing with working directories and paths explicitly can be a very large pain, and as you might imagine, setting up a Config with paths requires those paths to flexibly work for all contributors to a project. This is where the <code>here</code> package comes in and this a <a href="https://github.com/jennybc/here_here">great vignette describing it</a>.</p>
</div>
<div id="readingsaving-data" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> Reading/Saving Data<a href="coding-practices.html#readingsaving-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="rds-vs-.rdata-files" class="section level3 hasAnchor" number="6.6.1">
<h3><span class="header-section-number">6.6.1</span> <code>.RDS</code> vs <code>.RData</code> Files<a href="coding-practices.html#rds-vs-.rdata-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One of the most common ways to load and save data in Base R is with the <code>load()</code> and <code>save()</code> functions to serialize multiple objects in a single <code>.RData</code> file. The biggest problems with this practice include an inability to control the names of things getting loaded in, the inherent confusion this creates in understanding older code, and the inability to load individual elements of a saved file. For this, we recommend using the RDS format to save R objects.</p>
<ul>
<li><strong>Note</strong>: if you have many related R objects you would have otherwise saved all together using the <code>save</code> function, the functional equivalent with <code>RDS</code> would be to create a (named) list containing each of these objects, and saving it.</li>
</ul>
</div>
<div id="csvs" class="section level3 hasAnchor" number="6.6.2">
<h3><span class="header-section-number">6.6.2</span> CSVs<a href="coding-practices.html#csvs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once again, the <code>readr</code> package as part of the Tidvyerse is great, with a much faster <code>read_csv()</code> than Base R’s <code>read.csv()</code>. For massive CSVs (&gt; 5 GB), you’ll find <code>data.table::fread()</code> to be the fastest CSV reader in any data science language out there. For writing CSVs, <code>readr::write_csv()</code> and <code>data.table::fwrite()</code> outclass Base R’s <code>write.csv()</code> by a significant margin as well.</p>
</div>
</div>
<div id="integrating-box-and-dropbox" class="section level2 hasAnchor" number="6.7">
<h2><span class="header-section-number">6.7</span> Integrating Box and Dropbox<a href="coding-practices.html#integrating-box-and-dropbox" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Box and Dropbox are cloud-based file sharing systems that are useful when dealing with large files. When our scripts generate large output files, the files can slow down the workflow if they are pushed to GitHub. This makes collaboration difficult when not everyone has a copy of the file, unless we decide to duplicate files and share them manually. The files might also take up a lot of local storage. Box and Dropbox help us avoid these issues by automatically storing the files, reading data, and writing data back to the cloud.</p>
<p>Box and Dropbox are separate platforms, but we can use either one to store and share files. To use them, we can install the packages that have been created to integrate Box and Dropbox into R. The set-up instructions are detailed below.</p>
<p>Make sure to authenticate before reading and writing from either Box or Dropbox. The authentication commands should go in the configuration file; it only needs to be done once. This will prompt you to give your login credentials for Box and Dropbox and will allow your application to access your shared folders.</p>
<div id="box" class="section level3 hasAnchor" number="6.7.1">
<h3><span class="header-section-number">6.7.1</span> Box<a href="coding-practices.html#box" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Follow the instructions in this section to use the <code>boxr</code> package. Note that there are a few setup steps that need to be done on the box website before you can use the <code>boxr</code> package, <a href="https://r-box.github.io/boxr/articles/boxr-app-interactive.html#create">explained here</a> in the section “Creating an Interactive App.” This gets the authentication keys that must be put in box.
Once that is done, add the authentication keys to your code in the configuration file, with <code>box_auth(client_id = "&lt;your_client_id&gt;", client_secret = "&lt;your_client_secret_id&gt;")</code>. It is also important to set the default working directory so that the code can reference the correct folder in box: <code>box_setwd(&lt;folder_id&gt;)</code>. The folder ID is the sequence of digits at the end of the URL.</p>
<p>Further details can be found <a href="https://github.com/r-box/boxr">here</a>.</p>
</div>
<div id="dropbox" class="section level3 hasAnchor" number="6.7.2">
<h3><span class="header-section-number">6.7.2</span> Dropbox<a href="coding-practices.html#dropbox" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Follow the instructions at <a href="https://github.com/karthik/rdrop2">this link</a> to use the <code>rdrop2</code> package. Similar to the <code>boxr</code> package, you must authenticate before reading and writing from Dropbox, which can be done by adding <code>drop_auth()</code> to the configuration file.</p>
<p>Saving the authentication token is not required, although it may be useful if you plan on using Dropbox frequently. To do so, save the token with the following commands. Tokens are valid until they are manually revoked.</p>
<pre><code># first time only
# save the output of drop_auth to an RDS file
token &lt;- drop_auth()
# this token only has to be generated once, it is valid until revoked
saveRDS(token, &quot;/path/to/tokenfile.RDS&quot;)

# all future usages
# to use a stored token, provide the rdstoken argument
drop_auth(rdstoken = &quot;/path/to/tokenfile.RDS&quot;)
</code></pre>
</div>
</div>
<div id="tidyverse" class="section level2 hasAnchor" number="6.8">
<h2><span class="header-section-number">6.8</span> Tidyverse<a href="coding-practices.html#tidyverse" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Throughout this document there have been references to the Tidyverse, but this section is to explicitly show you how to transform your Base R tendencies to Tidyverse (or Data.Table, Tidyverse’s performance-optimized competitor). For most of our work that does not utilize very large datasets, we recommend that you code in Tidyverse rather than Base R. Tidyverse is quickly becoming <a href="https://rviews.rstudio.com/2017/06/08/what-is-the-tidyverse/">the gold standard</a> in R data analysis and modern data science packages and code should use Tidyverse style and packages unless there’s a significant reason not to (i.e. big data pipelines that would benefit from Data.Table’s performance optimizations).</p>
<p>The package author has published a <a href="https://r4ds.had.co.nz/">great textbook on R for Data Science</a>, which leans heavily on many Tidyverse packages and may be worth checking out.</p>
<p>The following list is not exhaustive, but is a compact overview to begin to translate Base R into something better:</p>
<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Base R</th>
<th>Better Style, Performance, and Utility</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>_</td>
<td>_</td>
</tr>
<tr class="even">
<td><code>read.csv()</code></td>
<td><code>readr::read_csv()</code> or <code>data.table::fread()</code></td>
</tr>
<tr class="odd">
<td><code>write.csv()</code></td>
<td><code>readr::write_csv()</code> or <code>data.table::fwrite()</code></td>
</tr>
<tr class="even">
<td><code>readRDS</code></td>
<td><code>readr::read_rds()</code></td>
</tr>
<tr class="odd">
<td><code>saveRDS()</code></td>
<td><code>readr::write_rds()</code></td>
</tr>
<tr class="even">
<td>_</td>
<td>_</td>
</tr>
<tr class="odd">
<td><code>data.frame()</code></td>
<td><code>tibble::tibble()</code> or <code>data.table::data.table()</code></td>
</tr>
<tr class="even">
<td><code>rbind()</code></td>
<td><code>dplyr::bind_rows()</code></td>
</tr>
<tr class="odd">
<td><code>cbind()</code></td>
<td><code>dplyr::bind_cols()</code></td>
</tr>
<tr class="even">
<td><code>df$some_column</code></td>
<td><code>df %&gt;% dplyr::pull(some_column)</code></td>
</tr>
<tr class="odd">
<td><code>df$some_column = ...</code></td>
<td><code>df %&gt;% dplyr::mutate(some_column = ...)</code></td>
</tr>
<tr class="even">
<td><code>df[get_rows_condition,]</code></td>
<td><code>df %&gt;% dplyr::filter(get_rows_condition)</code></td>
</tr>
<tr class="odd">
<td><code>df[,c(col1, col2)]</code></td>
<td><code>df %&gt;% dplyr::select(col1, col2)</code></td>
</tr>
<tr class="even">
<td><code>merge(df1, df2, by = ..., all.x = ..., all.y = ...)</code></td>
<td><code>df1 %&gt;% dplyr::left_join(df2, by = ...)</code> or <code>dplyr::full_join</code> or <code>dplyr::inner_join</code> or <code>dplyr::right_join</code></td>
</tr>
<tr class="odd">
<td>_</td>
<td>_</td>
</tr>
<tr class="even">
<td><code>str()</code></td>
<td><code>dplyr::glimpse()</code></td>
</tr>
<tr class="odd">
<td><code>grep(pattern, x)</code></td>
<td><code>stringr::str_which(string, pattern)</code></td>
</tr>
<tr class="even">
<td><code>gsub(pattern, replacement, x)</code></td>
<td><code>stringr::str_replace(string, pattern, replacement)</code></td>
</tr>
<tr class="odd">
<td><code>ifelse(test_expression, yes, no)</code></td>
<td><code>if_else(condition, true, false)</code></td>
</tr>
<tr class="even">
<td>Nested: <code>ifelse(test_expression1, yes1, ifelse(test_expression2, yes2, ifelse(test_expression3, yes3, no)))</code></td>
<td><code>case_when(test_expression1 ~ yes1,  test_expression2 ~ yes2, test_expression3 ~ yes3, TRUE ~ no)</code></td>
</tr>
<tr class="odd">
<td><code>proc.time()</code></td>
<td><code>tictoc::tic()</code> and <code>tictoc::toc()</code></td>
</tr>
<tr class="even">
<td><code>stopifnot()</code></td>
<td><code>assertthat::assert_that()</code> or <code>assertthat::see_if()</code> or <code>assertthat::validate_that()</code></td>
</tr>
</tbody>
</table>
<p>For a more extensive set of syntactical translations to Tidyverse, you can check out <a href="https://tavareshugo.github.io/data_carpentry_extras/base-r_tidyverse_equivalents/base-r_tidyverse_equivalents.html#reshaping_data">this document</a>.</p>
<p>Working with Tidyverse within functions can be somewhat of a pain due to non-standard evaluation (NSE) semantics. If you’re an avid function writer, we’d recommend checking out the following resources:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=nERXS3ssntw">Tidy Eval in 5 Minutes</a> (video)</li>
<li><a href="https://tidyeval.tidyverse.org/index.html">Tidy Evaluation</a> (e-book)</li>
<li><a href="https://www.brodrigues.co/blog/2016-07-18-data-frame-columns-as-arguments-to-dplyr-functions/">Data Frame Columns as Arguments to Dplyr Functions</a> (blog)</li>
<li><a href="https://stackoverflow.com/questions/28125816/r-standard-evaluation-for-join-dplyr">Standard Evaluation for *_join</a> (stackoverflow)</li>
<li><a href="https://dplyr.tidyverse.org/articles/programming.html">Programming with dplyr</a> (package vignette)</li>
</ul>
</div>
<div id="coding-with-r-and-python" class="section level2 hasAnchor" number="6.9">
<h2><span class="header-section-number">6.9</span> Coding with R and Python<a href="coding-practices.html#coding-with-r-and-python" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If you’re using both R and Python, you may wish to check out the <a href="https://www.rdocumentation.org/packages/feather/versions/0.3.3">Feather package</a> for exchanging data between the two languages <a href="https://blog.rstudio.com/2016/03/29/feather/">extremely quickly</a>.</p>
</div>
<div id="repeating-analyses-with-different-variations" class="section level2 hasAnchor" number="6.10">
<h2><span class="header-section-number">6.10</span> Repeating analyses with different variations<a href="coding-practices.html#repeating-analyses-with-different-variations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In many cases, we will need to apply our modeling on different combinations of interests (outcomes, exposures, etc.). We can certainly use a <code>for</code> loop to repeat the execution of a wrapper function, but generally, <code>for</code> loops request high memory usage and produce the results in long computation time.</p>
<p>Fortunately, R has some functions which implement looping in a compact form to help repeating your analyses with different variations (subgroups, outcomes, covariate sets, etc.) with better performances.</p>
<div id="lapply-and-sapply" class="section level3 hasAnchor" number="6.10.1">
<h3><span class="header-section-number">6.10.1</span> <code>lapply()</code> and <code>sapply()</code><a href="coding-practices.html#lapply-and-sapply" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>lapply()</code> is a function in the base R package that applies a function to each element of a list and returns a list. It’s typically faster than <code>for</code>. Here is a simple generic example:</p>
<pre><code>result &lt;- lapply(X = mylist, FUN = func)</code></pre>
<p>There is another very similar function called <code>sapply()</code>. It also takes a list as its input, but if the output of the <code>func</code> is of the same length for each element in the input list, then <code>sapply()</code> will simplify the output to the simplest data structure possible, which will usually be a vector.</p>
</div>
<div id="mapply-and-pmap" class="section level3 hasAnchor" number="6.10.2">
<h3><span class="header-section-number">6.10.2</span> <code>mapply()</code> and <code>pmap()</code><a href="coding-practices.html#mapply-and-pmap" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sometimes, we’d like to employ a wrapper function that takes arguments from multiple different lists/vectors. Then, we can consider using <code>mapply()</code> from the base R package or <code>pmap()</code> from the <code>purrr</code> package.</p>
<p>Please see the simple specific example below where the two input lists are of the same length and we are doing a pairwise calculation:</p>
<pre><code>mylist1 = list(0:3)
mylist2 = list(6:9)
mylists = list(mylist1, mylist2)

square_sum &lt;- function(x, y) {
  x^2 + y^2
}

#Use `mapply()`
result1 &lt;- mapply(FUN = square_sum, mylist1, mylist2)

#Use `pmap()`
library(purrr)
result2 &lt;- pmap(.l = mylists, .f = square_sum)

#unlist(as.list(result1)) = result2 = [36 50 68 90]
</code></pre>
<p>There are two major differences between <code>mapply()</code> and <code>pmap()</code>. The first difference is that <code>mapply()</code> takes seperate lists as its input arguments, while <code>pmap()</code> takes a list of list. Secondly, the output of <code>mapply()</code> will be in the form of a matrix or an array, but <code>pmap()</code> produces a list directly.</p>
<p>However, when <strong>the input lists are of different lengths AND/OR the wrapper function doesn’t take arguments in pairs, <code>mapply()</code> and <code>pmap()</code> may not give the preferable results.</strong></p>
<p>Both <code>mapply()</code> and <code>pmap()</code> will recycle shorter input lists to match the length of the longest input list. Assume that now <code>mylist2 = list(6:12)</code>. Then, <code>pmap(mylists, square_sum)</code> will generate <code>[36  50  68  90 100 122 148]</code> where elements 0, 1, and 2 are recycled to match 10, 11, and 12. And it will return an error message that “longer object length is not a multiple of shorter object length.”</p>
<p>Thus, unless the recycling pattern described above is desirable feature for a certain experiment design, <strong>when the input lists are of different lengths, the best practice is probably to use <code>lapply()</code> and then combine the results.</strong></p>
<p>Here is an example where we’d like to find the <code>square_sum</code> for every element combination of <code>mylist1</code> and <code>mylist2</code>.</p>
<pre><code>mylist1 &lt;- list(0:3)
mylist2 &lt;- list(6:12)

square_sum &lt;- function(x, y) {
  x^2 + y^2
}

results &lt;- list()

for (i in seq_along(mylist1[[1]])) {
  result &lt;- lapply(X = mylist2, FUN = function(y) square_sum(mylist1[[1]][i], y))
  results[[i]] &lt;- result
}
</code></pre>
<p>This example doesn’t work in the way that 0 is paired to 6, 1 is paired to 7, and so on. Instead, every element in <code>mylist1</code> will be paired with every element in <code>mylist2</code>. Thus, the “unlisted” results from the example will have <span class="math inline">\(4*7 = 28\)</span> elements.</p>
<p>We can use <code>flatten()</code> or <code>unlist()</code> functions to decrease the depths of our results. If the results are data frames, then we will need to use <code>bind_rows()</code> to combine them.</p>
</div>
<div id="parallel-processing-with-parallel-and-future-packages" class="section level3 hasAnchor" number="6.10.3">
<h3><span class="header-section-number">6.10.3</span> Parallel processing with <code>parallel</code> and <code>future</code> packages<a href="coding-practices.html#parallel-processing-with-parallel-and-future-packages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One big drawback of <code>lapply()</code> is its long computation time, especially when the list length is long. Fortunately, computers nowadays must have multiple cores which makes parallel processing possible to help make computation much faster.</p>
<p>Assume you have a list called <code>mylist</code> of length 1000, and <code>lapply(X = mylist, FUN = func)</code> applies the function to each of the 1000 elements one by one in <span class="math inline">\(T\)</span> seconds. If we could execute the <code>func</code> in <span class="math inline">\(n\)</span> processors simultaneously, then ideally, we would shrink the computation time to <span class="math inline">\(T/n\)</span> seconds.</p>
<p>In practice, using functions under the <code>parallel</code> and the <code>future</code> packages, we can split <code>mylist</code> into smaller chunks and apply the function to each element of the several chunks in parallel in different cores to significantly reduce the run time.</p>
<div id="parlapply" class="section level4 hasAnchor" number="6.10.3.1">
<h4><span class="header-section-number">6.10.3.1</span> <code>parLapply()</code><a href="coding-practices.html#parlapply" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Below is a generic example of <code>parLapply()</code>:</p>
<pre><code>library(parallel)

# Set how many processors will be used to process the list and make cluster
n_cores &lt;- 4
cl &lt;- makeCluster(n_cores)

#Use parLapply() to apply func to each element in mylist
result &lt;- parLapply(cl = cl, x = mylist, FUN = func)

#Stop the parallel processing
stopCluster(cl)</code></pre>
<p>Let’s still assume <code>mylist</code> is of length 1000. The <code>parLapply</code> above splits <code>mylist</code> into 4 sub-lists each of length 250 and applies the function to the elements of each sub-list in parallel. To be more specific, first apply the function to element 1, 251, 501, 751; second apply to element 2, 252, 502, 752; so on and so forth. As such, the computation time will be greatly reduced.</p>
<p>You can use <code>parallel::detectCores()</code> to test how many cores your machine has and to help decide what to put for <code>n_cores</code>. It would be a good idea to leave at least one core free for the operating system to use.</p>
<p>We will always start <code>parLapply()</code> with <code>makeCluster()</code>. <strong><code>stopCluster()</code> is not fully necessary but follows the best practices.</strong> If not stopped, the processing will continue in the back end and consuming the computation capacity for other software in your machine. But keep in mind that stopping the cluster is similar quitting R, meaning that you will need to re-load the packages needed when you need to do parallel processing use <code>parLapply()</code> again.</p>
</div>
<div id="future.lapply" class="section level4 hasAnchor" number="6.10.3.2">
<h4><span class="header-section-number">6.10.3.2</span> <code>future.lapply()</code><a href="coding-practices.html#future.lapply" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Below is a generic example of <code>future.lapply()</code>:</p>
<pre><code>library(future)
library(future.apply)

# First, plan how the future_lapply() will be resolved
future::plan(
  multisession, workers = future::availableCores() - 1
)

# Use future_lapply() to apply func to each element in mylist
future_lapply(x = mylist, FUN = func)</code></pre>
<p>Here, <code>future::availableCores()</code> checks how many cores your machine has. Similar to <code>parLapply()</code> showed above, <code>future_lapply()</code> parallelizes the computation of <code>lapply()</code> by executing the function <code>func</code> simultaneously on different sub-lists of <code>mylist</code>.</p>
</div>
</div>
</div>
<div id="reviewing-code" class="section level2 hasAnchor" number="6.11">
<h2><span class="header-section-number">6.11</span> Reviewing Code<a href="coding-practices.html#reviewing-code" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before publishing new changes, it is important to ensure that the code has been tested and well-documented. GitHub makes it possible to document all of these changes in a pull request. Pull requests can be used to describe changes in a branch that are ready to be merged with the base branch (more information in the <a href="#Github">GitHub</a> section). Github allows users to create a pull request template in a repository to standardize and customize the information in a pull request. When you add a pull request template to your repository, everyone will automatically see the template’s contents in the pull request body.</p>
<div id="creating-a-pull-request-template" class="section level3 hasAnchor" number="6.11.1">
<h3><span class="header-section-number">6.11.1</span> Creating a Pull Request Template<a href="coding-practices.html#creating-a-pull-request-template" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Follow the instructions below to add a pull request template to a repository. More details can be found at this <a href="https://help.github.com/en/github/building-a-strong-community/creating-a-pull-request-template-for-your-repository">GitHub link</a>.</p>
<ol style="list-style-type: decimal">
<li>On GitHub, navigate to the main page of the repository.</li>
<li>Above the file list, click <code>Create new file</code>.</li>
<li>Name the file <code>pull_request_template.md</code>. GitHub will not recognize this as the template if it is named anything else. The file must be on the <code>master</code> branch.
<ol style="list-style-type: decimal">
<li>To store the file in a hidden directory instead of the main directory, name the file <code>.github/pull_request_template.md</code>.</li>
</ol></li>
<li>In the body of the new file, add your pull request template. This could include:
<ul>
<li>A summary of the changes proposed in the pull request</li>
<li>How the change has been tested</li>
<li>@mentions of the person or team responsible for reviewing proposed changes</li>
</ul></li>
</ol>
<p>Here is an example pull request template.</p>
<pre class="text"><code># Description

## Summary of change

Please include a summary of the change, including any new functions added and example usage. 

## Link to Spec

Please include a link to the Trello card or Google document with details of the task. 

## Who should review the pull request?
@ ...
</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="code-repositories.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="coding-style.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/water-health-opportunity-lab/who-lab-manual/edit/master/05-coding-practices.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["who-lab-manual.pdf", "who-lab-manual.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
